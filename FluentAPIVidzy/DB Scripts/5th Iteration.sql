--Command:
--update-database -script -sourceMigration:0

DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'FluentAPIVidzy.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201810190449441_AddVideosTableAndGenresTable'
BEGIN
    CREATE TABLE [dbo].[Genres] (
        [Id] [tinyint] NOT NULL,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Videos] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        [ReleaseDate] [datetime] NOT NULL,
        CONSTRAINT [PK_dbo.Videos] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[VideoGenres] (
        [Video_Id] [int] NOT NULL,
        [Genre_Id] [tinyint] NOT NULL,
        CONSTRAINT [PK_dbo.VideoGenres] PRIMARY KEY ([Video_Id], [Genre_Id])
    )
    CREATE INDEX [IX_Video_Id] ON [dbo].[VideoGenres]([Video_Id])
    CREATE INDEX [IX_Genre_Id] ON [dbo].[VideoGenres]([Genre_Id])
    ALTER TABLE [dbo].[VideoGenres] ADD CONSTRAINT [FK_dbo.VideoGenres_dbo.Videos_Video_Id] FOREIGN KEY ([Video_Id]) REFERENCES [dbo].[Videos] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[VideoGenres] ADD CONSTRAINT [FK_dbo.VideoGenres_dbo.Genres_Genre_Id] FOREIGN KEY ([Genre_Id]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201810190449441_AddVideosTableAndGenresTable', N'FluentAPIVidzy.Migrations.Configuration',  0x1F8B0800000000000400DD59DB6EE336107D2FD07F10F4D416592B9797AD61EF22EB2445D04D1CC449D0B78096C60E518A52492AB0B7E897F5A19FD45FE8507791922D7B17DEB60810D8E4CC702E8773A1FFFEF3AFD1FB55C89C571092467CEC9E0C8E5D07B81F05942FC76EA2166FDEBAEFDF7DFBCDE8320857CE534177A6E99093CBB1FBA2543CF43CE9BF4048E420A4BE8864B450033F0A3D1244DEE9F1F18FDEC9890728C245598E33BA4FB8A221A45FF0EB24E23EC42A21EC260A80C97C1D7766A954E796842063E2C3D89D20C51515523DD1E0D37A9032B8CE39A3047599015BB80EE13C5244A1A6C34709332522BE9CC5B840D8C33A06A45B102621B7605891F735E6F8541BE3558C85283F912A0A77147872967BC733D9F7F2B15B7A0FFD77897E566B6D75EAC3B1FB137081969B270D274C68AA76FF0E52AE23A7B97754E20161A3FF9020612A1130E6902841D8917397CC19F57F86F543F42BF0314F18ABEB871AE25E630197EE44148350EB7B58E45A5F07AEE335F93C93B164ABF164267D582B34F916CF26730665F4BD8DECFA7F21002184F7C1756EC8EA23F0A57A19BBF8D175AEE80A82622597FAC8295E1F645222B10FB925AF74997ADC380E3D0A91749D7B60E9B67CA17186E741BAF59C860009AE4414DE47AC60C9D79F1F8858824285A396CD599408DF5066E455D8D8889854D2CE8849B9FEB388B9E6EAECB4053235F3672A1280FE05411404774429105CCB80D4815F075EC621082620122E882ACFD29F1F68D8E33E7442B540E2BE502DD0D80AD502C77DA07A2E65E4D354873A568BF39BE65CF2C0D9A44C1689D2088C062293C688453C79ECFE60F9A7436079112B8179CEDD2870E4D5ACB1EF235648452882AD32F4D3FA62AE9761A55A6E2716BEFC82CA1C2BA6F65AEC0C9411D4CAD34DE52DE39BEC45FAB2D873671AEC355B0D1925786A246DE03233C096F096FA56AA7A3D451401AD89287434134CD3AC16049761AC3A1C2F6B718A56C8EBE8854637248E314BD47AA37CC599E58DD19BD9EEFD4298C9F07CD9D23694DA962761CE234B30766B1500B30B99139D4C2641689119A0ED40547158039776AC0A9C15E4FA73C6D2DDC198622A275EA15D2166EED44430436DF3A5AD296144B4949049C492907795A14DDC5951A8F3672BB6849167286E3AC8B33C6460D5F477AF68E477E7B3A3916585DDA3D1C1F7B5A3D125A1517FEB821A1B878F6E334FB584B8CCC27DE25812B746ABF502E95CDBD6001B69DB764CAF3067A2DA82AD1D531EBCA34E791DD853A754C88E3A9905C58EA555574C921249657D31EAC828CFE93B0CDE4592CF485C07757F454761829FADA58270A00906B3DFD88451C46E457043385D80545967EFE2E47B6A4CEEFF9E29DA9332607D46E983CF268AF235D56EFD8C8196BF12E1BF10F15D4856DFD725D953C58E73E2C1DD91BA62EB3076185FF59AC002FCACB64F60BBF97D6F2C6EC89536715712DB1EAFEA985AD4ACA1E59A07B01ABBBFA74C43E7FA97E782EFC8990ACC2043E7D8F963E768566A1B37A8870205EF0E0AEC37AEB6D63C7326D93EA79E58A576CA2F10840A9C733F4BA613227D12D85ED37568E3E9F92868AAD067BCD56FBEB000A1EF236158AEA41258B0ACC6E64E50EED398B086D576CDED9345B449A53C73E70262E03A3DD806F6396D538B518A36DCBBCD019D4F005B80D3D698D4426747AD3560FF33E0F40FE56181B3A90FFCE2C0697F3BB2A7F51E4F43DD2F43591B88756DAED35396153B1E485A5F8DBA1F8DDA24B7BFDEB44BEE52BCBED9794687095B5FAECA27A7CD0F581D238E9DF0ADE977EBC355C36C7310EBFF66D5CBD8E2716C8BB1EDB3939DA4AC87974319BBC3039D3D30E10DADFD9E891942D2652542FFBAC9C16FDCCD92E69A2FA22249181A1524463373038A600B49CE85A20BE22BDCF641CAF4078427C21224B90CE7105CF369A2E244A1C910CE59E307099D6A369D9FBE4236751E4DE3F4ADFF4B98806A52DD054FF98784B2A0D4FBAAA597EA10A17358DEEFEB582ADDF72FD7A5A4DB88F71494BBAF4CBD0F10C60C85C9299F9157D847B747091F6149FC7531F7760BD91E88A6DB4717942C0509652EA3E2C7AF88E1205CBDFB076694ED11D61F0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201810190451565_PopulateGenresTable'
BEGIN
    INSERT INTO dbo.Genres(Id, Name) VALUES(1, 'Comedy')
    INSERT INTO dbo.Genres(Id, Name) VALUES(2, 'Musical')
    INSERT INTO dbo.Genres(Id, Name) VALUES(3, 'Anime')
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201810190451565_PopulateGenresTable', N'FluentAPIVidzy.Migrations.Configuration',  0x1F8B0800000000000400DD59DB6EE336107D2FD07F10F4D416592B9797AD61EF22EB2445D04D1CC449D0B78096C60E518A52492AB0B7E897F5A19FD45FE8507791922D7B17DEB60810D8E4CC702E8773A1FFFEF3AFD1FB55C89C571092467CEC9E0C8E5D07B81F05942FC76EA2166FDEBAEFDF7DFBCDE8320857CE534177A6E99093CBB1FBA2543CF43CE9BF4048E420A4BE8864B450033F0A3D1244DEE9F1F18FDEC9890728C245598E33BA4FB8A221A45FF0EB24E23EC42A21EC260A80C97C1D7766A954E796842063E2C3D89D20C51515523DD1E0D37A9032B8CE39A3047599015BB80EE13C5244A1A6C34709332522BE9CC5B840D8C33A06A45B102621B7605891F735E6F8541BE3558C85283F912A0A77147872967BC733D9F7F2B15B7A0FFD77897E566B6D75EAC3B1FB137081969B270D274C68AA76FF0E52AE23A7B97754E20161A3FF9020612A1130E6902841D8917397CC19F57F86F543F42BF0314F18ABEB871AE25E630197EE44148350EB7B58E45A5F07AEE335F93C93B164ABF164267D582B34F916CF26730665F4BD8DECFA7F21002184F7C1756EC8EA23F0A57A19BBF8D175AEE80A82622597FAC8295E1F645222B10FB925AF74997ADC380E3D0A91749D7B60E9B67CA17186E741BAF59C860009AE4414DE47AC60C9D79F1F8858824285A396CD599408DF5066E455D8D8889854D2CE8849B9FEB388B9E6EAECB4053235F3672A1280FE05411404774429105CCB80D4815F075EC621082620122E882ACFD29F1F68D8E33E7442B540E2BE502DD0D80AD502C77DA07A2E65E4D354873A568BF39BE65CF2C0D9A44C1689D2088C062293C688453C79ECFE60F9A7436079112B8179CEDD2870E4D5ACB1EF235648452882AD32F4D3FA62AE9761A55A6E2716BEFC82CA1C2BA6F65AEC0C9411D4CAD34DE52DE39BEC45FAB2D873671AEC355B0D1925786A246DE03233C096F096FA56AA7A3D451401AD89287434134CD3AC16049761AC3A1C2F6B718A56C8EBE8854637248E314BD47AA37CC599E58DD19BD9EEFD4298C9F07CD9D23694DA962761CE234B30766B1500B30B99139D4C2641689119A0ED40547158039776AC0A9C15E4FA73C6D2DDC198622A275EA15D2166EED44430436DF3A5AD296144B4949049C492907795A14DDC5951A8F3672BB6849167286E3AC8B33C6460D5F477AF68E477E7B3A3916585DDA3D1C1F7B5A3D125A1517FEB821A1B878F6E334FB584B8CCC27DE25812B746ABF502E95CDBD6001B69DB764CAF3067A2DA82AD1D531EBCA34E791DD853A754C88E3A9905C58EA555574C921249657D31EAC828CFE93B0CDE4592CF485C07757F454761829FADA58270A00906B3DFD88451C46E457043385D80545967EFE2E47B6A4CEEFF9E29DA9332607D46E983CF268AF235D56EFD8C8196BF12E1BF10F15D4856DFD725D953C58E73E2C1DD91BA62EB3076185FF59AC002FCACB64F60BBF97D6F2C6EC89536715712DB1EAFEA985AD4ACA1E59A07B01ABBBFA74C43E7FA97E782EFC8990ACC2043E7D8F963E768566A1B37A8870205EF0E0AEC37AEB6D63C7326D93EA79E58A576CA2F10840A9C733F4BA613227D12D85ED37568E3E9F92868AAD067BCD56FBEB000A1EF236158AEA41258B0ACC6E64E50EED398B086D576CDED9345B449A53C73E70262E03A3DD806F6396D538B518A36DCBBCD019D4F005B80D3D698D4426747AD3560FF33E0F40FE56181B3A90FFCE2C0697F3BB2A7F51E4F43DD2F43591B88756DAED35396153B1E485A5F8DBA1F8DDA24B7BFDEB44BEE52BCBED9794687095B5FAECA27A7CD0F581D238E9DF0ADE977EBC355C36C7310EBFF66D5CBD8E2716C8BB1EDB3939DA4AC87974319BBC3039D3D30E10DADFD9E891942D2652542FFBAC9C16FDCCD92E69A2FA22249181A1524463373038A600B49CE85A20BE22BDCF641CAF4078427C21224B90CE7105CF369A2E244A1C910CE59E307099D6A369D9FBE4236751E4DE3F4ADFF4B98806A52DD054FF98784B2A0D4FBAAA597EA10A17358DEEFEB582ADDF72FD7A5A4DB88F71494BBAF4CBD0F10C60C85C9299F9157D847B747091F6149FC7531F7760BD91E88A6DB4717942C0509652EA3E2C7AF88E1205CBDFB076694ED11D61F0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201810190458135_ChangeRelationshipVideoGenresToOneOne'
BEGIN
    IF object_id(N'[dbo].[FK_dbo.VideoGenres_dbo.Videos_Video_Id]', N'F') IS NOT NULL
        ALTER TABLE [dbo].[VideoGenres] DROP CONSTRAINT [FK_dbo.VideoGenres_dbo.Videos_Video_Id]
    IF object_id(N'[dbo].[FK_dbo.VideoGenres_dbo.Genres_Genre_Id]', N'F') IS NOT NULL
        ALTER TABLE [dbo].[VideoGenres] DROP CONSTRAINT [FK_dbo.VideoGenres_dbo.Genres_Genre_Id]
    IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Video_Id' AND object_id = object_id(N'[dbo].[VideoGenres]', N'U'))
        DROP INDEX [IX_Video_Id] ON [dbo].[VideoGenres]
    IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Genre_Id' AND object_id = object_id(N'[dbo].[VideoGenres]', N'U'))
        DROP INDEX [IX_Genre_Id] ON [dbo].[VideoGenres]
    ALTER TABLE [dbo].[Videos] ADD [Genre_Id] [tinyint]
    CREATE INDEX [IX_Genre_Id] ON [dbo].[Videos]([Genre_Id])
    ALTER TABLE [dbo].[Videos] ADD CONSTRAINT [FK_dbo.Videos_dbo.Genres_Genre_Id] FOREIGN KEY ([Genre_Id]) REFERENCES [dbo].[Genres] ([Id])
    DROP TABLE [dbo].[VideoGenres]
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201810190458135_ChangeRelationshipVideoGenresToOneOne', N'FluentAPIVidzy.Migrations.Configuration',  0x1F8B0800000000000400D559DB6EE336107D2FD07F10F4D416592B9797AD61EF22EB2485D1CD055112F42DA0A5B143942255920AEC2DFA657DE827F5173AD45D94E4C8DE6EB64580C021670EE77238C371FEFEF3AFC9FB75C49C67908A0A3E758F4687AE033C1021E5ABA99BE8E59BB7EEFB77DF7E33390FA3B5F350C89D1839D4E46AEA3E691D8F3D4F054F1011358A682085124B3D0A44E4915078C787873F7A47471E20848B588E33B94DB8A611A47FE09F33C103887542D8A50881A97C1D77FC14D5B92211A89804307567287141A5D20F34FCB419A50AAE73CA28415B7C604BD7219C0B4D345A3ABE57E06B29F8CA8F7181B0BB4D0C28B7244C41EEC1B8121FEACCE1B171C6AB140BA820515A443B021E9DE4D1F16CF5BD62EC96D1C3F89D639CF5C6789DC670EAFE045CA2E7F649E3199346AA3BBEA354EBC069EE1D947C40DA981F1448984E244C39245A1276E0DC240B46839F6173277E053EE5096375FBD042DC6B2CE0D28D143148BDB985656EF53C741DAFA9E7D98AA55A4D2773E9C346A3CB577836593028B3EF6D5537BF0B00A410DE07D7B924EB8FC057FA69EAE247D7B9A06B088B951CF59E53BC3EA8A465D23EE48A3CD3551A71EB388C2808E53AB7C0D26DF544E38CCFA374EB314FDC8514D1AD608546B6FC7847E40A349A2BDA7BBE4864605932F12A626CA54B0AB4335D52ADFF2D5DE65C9F1C77F0A5E6BEAF85040C2F48A221BC215A83E40603D2007E1D6E5987209380283823BA3CCB7CBEA3D180CBD0CBD39C86FBD1B4A062174D0B0A0FA1E9A95222A0A901759EE687373D39E7A1B3C5922C07A5FD9807E4248D918578EED4FDA115996EBCF202567879249A7887A3D191ED63CD9BF65DC4D6A80945A2558E7EDA9C2DCC32AC75C7CDC48E975F4E95F3C4B6DFC0FAA0EB09C5C25345BA697FCBFDA67A51B75AEA79382DF59AAF1646C19C9A4407B1ECBBBF3DBBA5B1959DDE3084229F35842250766169BAD4C1DE3285D5B3C6CBDE35C5FBC7EB79004D2E491C6375A83D88F215C7CF5F436FFCDD1F095186E105AAE3AD505A5B9E84B58EACC0DAAD557EAC2A64414C119985514BCC226C0F9B8AC31A9C6CA7AAE058216E3E672AFDCF161BA60AE205FA1561C54E5D043BD56DBDF43D4A18911DAD63265812F1BEF6B34D3B6B0675FD6CA58D30F12CC3ED0079AD08595CB5E33D281BF9D5F9EC6C641561F76CF4E87DED6CF42134FA6E1DA8B1F1FAD96DD6A98E14171578481A0BD941B93235B6EBB9DBACB5ED800C4A6F86D195641390F2DCDD4CCA1BC89E26ED6C0C16C790A6AF99B9322FB3F25536C451BB03B593DF6A44B64849BDB221598D679237811DC6F3A22B6422AE83BE3F6384B123F81BA5211A198191FF1B9B318A64AF042E09A74B503A1B015C9C8F8FADF9FEBF336B7B4A856CC8C0FDEA438CA67C434D583F63ECE5CF44064F447E1791F5F775A4F6F8B1E340F9EAE14843F1E2D4F63AB11A34AA85F8590F1AD5BA06B4C70E22B42685390F613D757F4F15C7CEFC97C742F7C0B9967813C7CEA1F3C77E79DF6F42AB35A0DD86A8F63B7E9FD10EC906D27081302C954A4B2C96AD2E7C83E37A4063C21A36B73BC510069BF89578F6CE19C4C00D351B6E0D39685B4B2C51ADABF492EF3B8EA9EDE160C014DA3F84664D046FC5C224362363CF3CD639A0F6CFA75DC8DDB3E2179C5D1BDED7269017A7D5F688FB65E6D376FB47C6D4BEC347B22ABAAA20CC8B8643D0E04A2933E74B5190D6B2A810B16ADA25688205919C4A4D9724D0B81D8052E9F7660F842528721E2D209CF3EB44C7894697215AB0C6F77086FADBCE4F87F0A6CD93EB38FD8EEBDF7001CDA4A6A65FF30F09656169F745BBA6F741983B95772F934B6DBAD86A53225D093E10280F5F590AEE208A1982A96BEE9367D8C7B67B051F6145824DF18AEB07793911CDB04FCE28594912A91CA3D237FF97F2CC3FA6DEFD03901DAAF8CA1A0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201810190501503_AddClassificationColumnToVideosTable'
BEGIN
    ALTER TABLE [dbo].[Videos] ADD [ClassificationType] [tinyint] NOT NULL DEFAULT 0
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201810190501503_AddClassificationColumnToVideosTable', N'FluentAPIVidzy.Migrations.Configuration',  0x1F8B0800000000000400D5595F6FDB36107F1FB0EF20E8697F52CB4E5EB6C06ED13A4961B44E822809F616D0D2D92146511A4905F6867DB23DEC23ED2BECA8FF22654776DB744381C222EF8E77C7DFFD63FEF9EBEFF19B75C49C271092C67CE28E0643D7011EC421E5AB899BAAE5AB9FDC37AFBFFD667C1E466BE7BEA43BD174C8C9E5C47D542A39F53C193C4244E420A2818865BC5483208E3C12C6DEF170F8B3371A7980225C94E538E39B942B1A41F6819FD3980790A894B0791C0293C53AEEF89954E79244201312C0C49D22C5051552DDD3F0F7CD2063709DB78C12D4C507B6741DC279AC88424D4FEF24F84AC47CE527B840D8ED2601A45B1226A1B0E0B426EF6BCCF0581BE3D58CA5A820952A8EF614383A29BCE399EC07F9D8ADBC87FE3B473FAB8DB63AF3E1C47D0F5CA0E5E649A753263455B77F0719D791D3DE3BAAF080B0D1FF9020652A1530E1902A41D891739D2E180D3EC0E636FE15F884A78C35F5430D71AFB5804BD7224E40A8CD0D2C0BAD67A1EB786D3ECF64ACD81A3CB949EF360A4DBEC4B3C9824175FBDE4E76FD7F29002184F1E03A73B2FE087CA51E272EFE749D0BBA86B05C29A4DE718AE1834C4AA4F62197E489AE328F1BC7A1472196AE73032CDB968F34C9F13CC8B61E8A8BBB10717413B392235F7EB82562050AD58DED3D3F4E45606832F66A60EC844B26686FB8645CFF5BB8CCB83A39EEC04BC37C5FC502D0BD208882F09A2805826B199039F0EB60CB3804910444C21951D559FAF72D8DF60F86292352D2250D32F3B5B04A7D8DD0F6F6F3D2B7464101F2C382A0047A57109401D22F08D2A81102A6713379C1C8AA2E2287C4C68F6DA19F2B5410202108B6414035325FDBF7738816200ADB7CCAB0F6BBCE3D61297E8EAC9B6A51BF8F5958D11EEFA6BDD637888EACE84F6CE7E76E6E2EBE95320E68E69366022AEEBD7DDC390F9D1D20A8D159E4B0397A9026E833BCF289FB83A57EB7BC2AB3D6F20A10B6E50D0783916961C31A3BC962CFA308E595C3B28B3F5BE86558AB0E58612B53204B1609C0D45F8BF5413563092B4A0DF2B6FE96F96DF6B22059EC853B0DF686AD868C32681B141D316D26F5DDB75B295BEBE9F59350DE674342E928B362B44DEA481CD515D6FDAA9737AC6563EB6DE96CC773922418A58D4EB75871FCA2CD7DE5EFDFFD45B90C2F901D4D60A56D75121631B20263B791B6B05C9005D1396E1A46169901D82D682A0F6B61D2BEAA126325B9FE5DA4DFADFDA829A676E205DA156129CE4C04F3AA6DBE6CD0208C888E9E601AB334E2DBFA8A5DDC79956FF2E72BB684B167286E3AC8B33C6460D5F477AFDB2842E7936F23CF08FBDFC616BEAF7D1BDB24B41AAAA6A0D6467F795D4D55536CD7FECB63A79D053B0054E6F73E2029697B214167F0AE29A99DC96D87F4024F2EA30B42DA21D5B9FBA95494A70355DA5B194CBD21CD7AA599D42D77D592F631D4AC6FF6E55B65CE24A9A057953BA3AC8D8B12B3C7AB4E59737212D741DB9FD0C3586FFC8D54100D34C1C0FF8D4D1945B0D70473C2E912A4CADB61F778383A369E85FE3B4F349E9421EBF34EF3E2B32FF6EC383DA84F7A2DE14F44048F447C1791F5F74D49F6D4BAE73BC48BBB2373C5B3C3FECBF8AAD7841FE26FF57927FC432151271E438E35D9CC706A5D4FDC3F32C65367F6CB43C97BE45C098CED5367E8FC7918920E9B281B256DBFA1CF9E3B0E194511BE2034BA08C3E42B71E0A7765DBF1694073421ACA5B35D7BFAC484F65F25CFDC398304B8067BCBAC3E07ED2AB2955423389FB37DCFB1DA1E667A4CCDDB87E6BC2C619C2DF4C5E660DC323F760ED4DBE7E92EC9DDB3ED179CB55BD63726A667A76B7B24FF32F3B4DD5020621A7F4C42B04ABAAA45E81E8943D0C24A4533E3CBB804ADA1514962E4B43928822996BC158A2E49A0703B00CC9BFA01B778E73A8F1610CEF855AA9254A1C9102D58EB4158437FD7F9D9A3415BE7F155923D877E0E13504DAAABC4157F97D2C67BDE859DD3B789D03155D4437D974AD7C5D5A6927419F39E820AF755A9E016A284A13079C57DF20487E87627E123AC48B029FBC2ED429EBF88B6DBC76794AC04896421A3E6C74FC47018AD5FFF0B263EAF5C531D0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201810210823281_ChangesInVideosAndGenresTable'
BEGIN
    IF object_id(N'[dbo].[FK_dbo.Videos_dbo.Genres_Genre_Id]', N'F') IS NOT NULL
        ALTER TABLE [dbo].[Videos] DROP CONSTRAINT [FK_dbo.Videos_dbo.Genres_Genre_Id]
    IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Genre_Id' AND object_id = object_id(N'[dbo].[Videos]', N'U'))
        DROP INDEX [IX_Genre_Id] ON [dbo].[Videos]
    EXECUTE sp_rename @objname = N'dbo.Videos.Genre_Id', @newname = N'GenreId', @objtype = N'COLUMN'
    DECLARE @var0 nvarchar(128)
    SELECT @var0 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.Genres')
    AND col_name(parent_object_id, parent_column_id) = 'Name';
    IF @var0 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[Genres] DROP CONSTRAINT [' + @var0 + ']')
    ALTER TABLE [dbo].[Genres] ALTER COLUMN [Name] [nvarchar](255) NOT NULL
    DECLARE @var1 nvarchar(128)
    SELECT @var1 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.Videos')
    AND col_name(parent_object_id, parent_column_id) = 'Name';
    IF @var1 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[Videos] DROP CONSTRAINT [' + @var1 + ']')
    ALTER TABLE [dbo].[Videos] ALTER COLUMN [Name] [nvarchar](255) NOT NULL
    DECLARE @var2 nvarchar(128)
    SELECT @var2 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.Videos')
    AND col_name(parent_object_id, parent_column_id) = 'GenreId';
    IF @var2 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[Videos] DROP CONSTRAINT [' + @var2 + ']')
    ALTER TABLE [dbo].[Videos] ALTER COLUMN [GenreId] [tinyint] NOT NULL
    CREATE INDEX [IX_GenreId] ON [dbo].[Videos]([GenreId])
    ALTER TABLE [dbo].[Videos] ADD CONSTRAINT [FK_dbo.Videos_dbo.Genres_GenreId] FOREIGN KEY ([GenreId]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201810210823281_ChangesInVideosAndGenresTable', N'FluentAPIVidzy.Migrations.Configuration',  0x1F8B0800000000000400D559DB6EE336107D2FD07F10F4D866ADC4C1026D60EF22EBC40BA3EB388892A06F012D8D1DA214A5925460B7E897F5A19FD45FE850374BA4E438CEA5BB0810D8E4CC702E678633F4BF7FFF33F8B88A98F30042D2980FDDA3DEA1EB000FE290F2E5D04DD5E2DD4FEEC70FDF7F37380FA395735BD21D6B3AE4E472E8DE2B959C789E0CEE2122B217D140C4325EA85E10471E0963AF7F78F8B37774E4018A705196E30CAE52AE6804D917FC3A8A7900894A099BC6213059ACE38E9F49752E48043221010CDD314B81ABD3CBC92D0DFF58F73206D7396594A02E3EB085EB10CE6345146A7A7223C15722E64B3FC105C2AED70920DD8230098505271BF25D8D39EC6B63BC0D63292A48A58AA3270A3C3A2EBCE399EC7BF9D8ADBC87FE3B473FABB5B63AF3E1D0FD0C5CA0E5E6492723263455BB7F7B19D781D3DC3BA8F080B0D17F07CE28652A1530E4902A41D8817399CE190D7E81F575FC1BF0214F19ABEB871AE25E6301972E459C8050EB2B58145A4F42D7F19A7C9EC958B1D57872933EAD159A7C81679339832AFADE5676FDBF148010C27C709D29597D01BE54F743B7FFFEBDEB8CE90AC272A5907AC329A60F322991EE70EA0579A0CB2C04C6F9E86288A5EB5C01CBB6E53D4D7280F7B2ADBB229263114757312B39F2E5BB6B2296A050FFD8DEF3E354048626036F8394ADF8C9043D193F19D7378B9F0957C7FD9650D6CCF7552C00DD0B8228082F895220B896019903BF12B019A722B480483823AA3A5C7FBEA6D1D36565D07A66CA8D1891922E6890F9540BAA7CA261DFDC7E466A1599B35F6695D9D3965965D6ED96596954CB2BD3B8891C33B2DC5C55FB24DC8F4DA12F957F88BA10045B234A6BC16EFA7E0AD11C44619B4F197618AE734BF07C6C32AC4835A83FC72CAC68FBDB692F7504D19115FDB1EDFCDCCDF5C55329E380663EA957B522EECDE3CE79E86C01C1069D45619CA20769823EC3900FDD1F2CF5DBE555E57A23AF006153DE916BD6BA193FC32C56E09C0679C331223220A19D0DE889B0B982E51184AE4F8461032631E0942BBB96521ED084B06EAD0D961D0BB056A9126EEE9C41025CD7CE6EDFEF726A5594ECA3AB130C2F3DE6948157438F7D53228F428E0AA059A29DCDF532AC544B1A63835A64B22CAAB889172DD607553709DB824D5169E2C5825B93BDEC2A2CF602BE067BCD56434659246B142D35D474FBF66CAA94DDE869056E7BFED424948E32D3A069524BA1AE42B89942BC7C0C29C715AF635E194C49926055ACCD2FC58AE3E7C3CBE89DFFF49E3ECA6578816C69ED2B6DAB93B013214B3076F168D4744C855478C59339D177CA288C2C3203B01D682A0F6B60D20E5589B1925C7FCE59BAA78C96C42ED8C76857A46B42D66C99A1B6F9B2F19130225A1ABB51CCD28877D7A66EEEBC55ABF3E72BB6848167286E1521CB4356C96EFA7BA76814A9F3EC68E415E1E9D1E8E0FBBFA3D125A1D104D7053536769757DD3975599D1751B79CB666B82EB26DFF8D3168554C93A43ABDAA9C46851C14D5EAF1671FAB7CE524AE836E7B40C461E9F2D75241D4D3043DFF77366214EDDD104C09A70B902AEF64DDFEE151DF7837FA7ADE703C2943B6CB43CE9BCFC2D86E63E3AF9EF59CC21F8808EE89B067DCAD429FF846F1E6AEC9DCF2E843C0DBFB6DA7C13FC4CFEA0506FF0A1F56A73BC1767B3574FFCCF84E9CC9AF7705EB813313989F27CEA1F3D70BBE19EC86D42E50ED3723164DF19B8E714647BCCF50BAD724D8D5ADBDCEF0F78DCC7B7697BDC338D73DCDE5971C66E75CC7350771C760D33AE9750F7A6D92DB87AE571C021BD6D75AF947C73E7B567C9D41CF6E4F1031B5DFAE10AB922E3722F42F591C8206562A9A095FC425660D8D4A12A3B84D41112CCCE45428BA2081C2ED00B0DCE9E7E1E2C1EB3C9A4338E1B35425A94293219AB3C673B386FEB6F3B369B6A9F3609664EFA22F6102AA49F5DD32E39F525A7BD81BB794E20E113AA78A1B55C752E99B75B9AE245DC47C474185FBAA52700D51C250989C719F3CC03EBADD48F8024B12ACCB2EB35BC8E38168BA7D7046C9529048163236FCF815311C46AB0FFF01058FB16FC21D0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201810211712070_AddTagsTableAndRelationshipManyToManyWithVideosTable'
BEGIN
    CREATE TABLE [dbo].[Tags] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](255) NOT NULL,
        CONSTRAINT [PK_dbo.Tags] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[VideoTags] (
        [VideoId] [int] NOT NULL,
        [TagId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.VideoTags] PRIMARY KEY ([VideoId], [TagId])
    )
    CREATE INDEX [IX_VideoId] ON [dbo].[VideoTags]([VideoId])
    CREATE INDEX [IX_TagId] ON [dbo].[VideoTags]([TagId])
    ALTER TABLE [dbo].[VideoTags] ADD CONSTRAINT [FK_dbo.VideoTags_dbo.Videos_VideoId] FOREIGN KEY ([VideoId]) REFERENCES [dbo].[Videos] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[VideoTags] ADD CONSTRAINT [FK_dbo.VideoTags_dbo.Tags_TagId] FOREIGN KEY ([TagId]) REFERENCES [dbo].[Tags] ([Id]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201810211712070_AddTagsTableAndRelationshipManyToManyWithVideosTable', N'FluentAPIVidzy.Migrations.Configuration',  0x1F8B0800000000000400ED5A6D6FDB3610FE3E60FF41D0C72DB5F282025B60B7489DA430D6BC204E8A7D2B688976885194265241BC61BF6C1FF693F61776D49BC5375B7212B71D8A02454CF28EC7BBE7EEC83BFDFBF73FC3B78F31F51E70C649C246FEC160DFF7300B9388B0C5C8CFC5FCD54FFEDB37DF7F373C8BE247EF63BDEE48AE034AC647FEBD10E97110F0F01EC7880F621266094FE66210267180A22438DCDFFF3938380830B0F08197E70D6F7226488C8B1FF0739CB010A72247F4228930E5D538CC4C0BAEDE258A314F518847FE39CD311327D7938F24FA633928087CEF841204B24C319DFB1E622C114880A4C7771C4F4596B0C5348501446F97298675734439AE4E70BC5ADEF530FB87F230C18AB06615E65C24714F8607479576029D7C2B1DFB8DF6407F67A067B194A72E7438F2DF6396C1C9F59D8EC73493ABECFA1D14547B9E3AB7D7E0016023FFED79E39C8A3CC32386739121BAE75DE7334AC25FF0F236F90DB311CB296DCB0712C29C320043D75992E24C2C6FF0BC927A12F95EA0D2053A6143D6A2298FF46E29E0C897B0379A51DC583F584B2EFFAF190084C01F7CEF023D7EC06C21EE47FEE1EBD7BE774E1E71548F545CEF1801F7012291E51D76BD440F64519840DB1F548C13EE7B379816D3FC9EA425C007C5D4A7CA92E75912DF24B4A628873FDDA26C8105C89F9873D324CF424D9261B042CA5AFC148C7AE3A7A0FA6AF13361E2E8D062CAD6F1A722C930A8176748E0E81A0981332679E042815F08D8B45D015A18717C8A44B3B9FCFB96C4FD7915D07AA2CB8D29E29CCC4958E854326A742261AF4E3FC1B52ACFD9CEB36AEFB17956ED755D05B9458B751E5E4EEB62C8518714C5944D88CEEE0D1C7A3B37D07C73EDCFEDDADBE7913528B367110580DD5096C72D8CE97E3CE1E714583627DB26B7FCA8327D2E3C8215229CD12558AD15D754CD5FE07886B3EA6C5342E132ED7B1F11EC0FF769C34ECAEAF7098D9AB587EBD75E4BF381229BF547A6F24B35B7074F384F4252E8A48D872AC4A9DB9DB1C85B13EF5681B8BA035C8006490A3A03938FFC1F0CF1EDFC1A4CADF855F156E577E0EBBE7FC54E216109EC9D84E5DD7A8C788822D3174013913A02E10267D25F1185B70607831326CCD84258485244DD526B241D039214A961AECF9CE21433194BDCBAEFB26B937FCDAD9B1D342D6D52CA3068A1A70BA88A48B21E036AF27A32A4D428B56257A4B1B5CC9C872B43182844803A1AEF2BA2C8E94C0EE347618951F0D0ACC214AF42B62EB9643BC5A26D2F88BBAB88A93A83717095BC8EEA0679A5C80DE465CC37880BB569A42D3569DBD7F7A4D60ACB354A87E3FA28D308BA3AA201E8F571A5C5A1D6B11E1ED423753E6EA934D7694DF06F82FF36675500DF6250CAD6F9A075A66E60BEAAB80465C9A52ECD048EDACCF002A529A4C556ADA61AF1A665A166FC6ADABF7E11973C82905BCA188DB4CD4E7035430BACCDC2D620E939C9B880E70C9A2179A91847B1B14C736A87CBD49B297E6BDAA976A57AB9FCBB247157542C91BD223F8773C5322914B74F1DD3265D512A431465969BEE38A179CCDCC9C94D5DDE5DDBF4E588C9611868821B59C8D09091B3557D77B246E5374FB6461935FB5BC341F7B9ADE1E2A03CF8DB8C9489EEFC9A4B479B97F326E2E6637BF8B759DAE6BF180C3A027F4F04CAD4DB1F7F56AACF8DBE97B6839AD52C01A1CAD45D7CBE5A6AF56B8B72653EB6BDAF95C46E2AA493390A46F61B7C6BD75E02395F2D9D040216FDC4D12F1CA6F58C7B87BEA4C14E73FFD0EE19C32AE76F6E141997807289EF81EC0FA023B8004C975CE07820170CA6BFD331250093D5820BC4C81C73511604FCC3FD8343ADD3F4E5747D02CE23DAA5F5B3F3129B206C49A45A9FD080610F280BEF516696CED632EDD9D5D8B96A0AB56CAC2FEE5E6F9D5A0511FC2D9EA155D0E0C378534F58841F47FE9F05DDB137F9F55345BAE75D65E09FC7DEBEF7D7337619BA21B5572DFD1BA4FA6ACD9E7ABBA9CE9D42CDB5D6ECB659D3CD162D7577006E45F624E05612F7DBB820EAB1ADCB4EDB1592AB0AD14E6BBD5AC9649B32E356E562D78BFE652AC45F5551D87A33EE6FA897844951FAD405D85C467E526F616760B13F2EFBC4CF1DE3C5F67069594C3796C54EFF23AC74B5DE2E91E27C1B3E3B4EECFD18B3C2EBA8D5A89F7CB8BA2DE5D310EEB4331986CAE4E8E81E583B31EE468C8DB3BDDA6F6BD2B87A3436AED61680555A3BE3D5945366EB162FD720528CD6AA7E6F6C9398BD95676D02351D9C75BD204735A8BFA88EF863AB563DEB21EB2ED3DA43DA2B4C7AA8D62A96BB38608F0E9759518270D5FA40192225278B150BF9B932C3A112A89A3513364FEA70A949542FD1AEF5175820784BA3934C90390A054C87185EA8F243A1EA538FB37886A309BBCA459A0B38328E6754F9F048C6DD75FB176D3C55E6E1555A7C0EF41C470031892C075CB17739697DD2726E795F3858C8805EBD58A52D857CB92E960DA7CB84756454A9AFC943B7384E2930E3576C8A1EF036B2DD71FC012F50B8AC0B836E269B0DA1AA7D784AD0224331AF78ACE8E12760388A1FDFFC076C2D1947A72F0000 , N'6.2.0-61023')
END

